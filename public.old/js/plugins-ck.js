/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 *//*global define: false*/(function(e,t){typeof exports=="object"&&exports?module.exports=t:typeof define=="function"&&define.amd?define(t):e.Mustache=t})(this,function(){function u(e,t){return RegExp.prototype.test.call(e,t)}function a(e){return!u(r,e)}function l(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function h(e){return String(e).replace(/[&<>"'\/]/g,function(e){return c[e]})}function p(e){this.string=e;this.tail=e;this.pos=0}function d(e,t){this.view=e;this.parent=t;this._cache={}}function v(){this.clearCache()}function m(t,n,r,i){var s="",o,u,a;for(var l=0,c=t.length;l<c;++l){o=t[l];u=o[1];switch(o[0]){case"#":a=r.lookup(u);if(typeof a=="object")if(f(a))for(var h=0,p=a.length;h<p;++h)s+=m(o[4],n,r.push(a[h]),i);else a&&(s+=m(o[4],n,r.push(a),i));else if(typeof a=="function"){var d=i==null?null:i.slice(o[3],o[5]);a=a.call(r.view,d,function(e){return n.render(e,r)});a!=null&&(s+=a)}else a&&(s+=m(o[4],n,r,i));break;case"^":a=r.lookup(u);if(!a||f(a)&&a.length===0)s+=m(o[4],n,r,i);break;case">":a=n.getPartial(u);typeof a=="function"&&(s+=a(r));break;case"&":a=r.lookup(u);a!=null&&(s+=a);break;case"name":a=r.lookup(u);a!=null&&(s+=e.escape(a));break;case"text":s+=u}}return s}function g(e){var t=[],n=t,r=[],i;for(var s=0,o=e.length;s<o;++s){i=e[s];switch(i[0]){case"#":case"^":r.push(i);n.push(i);n=i[4]=[];break;case"/":var u=r.pop();u[5]=i[2];n=r.length>0?r[r.length-1][4]:t;break;default:n.push(i)}}return t}function y(e){var t=[],n,r;for(var i=0,s=e.length;i<s;++i){n=e[i];if(n)if(n[0]==="text"&&r&&r[0]==="text"){r[1]+=n[1];r[3]=n[3]}else{r=n;t.push(n)}}return t}function b(e){return[new RegExp(l(e[0])+"\\s*"),new RegExp("\\s*"+l(e[1]))]}var e={};e.name="mustache.js";e.version="0.7.2";e.tags=["{{","}}"];e.Scanner=p;e.Context=d;e.Writer=v;var t=/\s*/,n=/\s+/,r=/\S/,i=/\s*=/,s=/\s*\}/,o=/#|\^|\/|>|\{|&|=|!/,f=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};e.escape=h;p.prototype.eos=function(){return this.tail===""};p.prototype.scan=function(e){var t=this.tail.match(e);if(t&&t.index===0){this.tail=this.tail.substring(t[0].length);this.pos+=t[0].length;return t[0]}return""};p.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n);this.tail=this.tail.substring(n);this.pos+=n}return t};d.make=function(e){return e instanceof d?e:new d(e)};d.prototype.push=function(e){return new d(e,this)};d.prototype.lookup=function(e){var t=this._cache[e];if(!t){if(e==".")t=this.view;else{var n=this;while(n){if(e.indexOf(".")>0){t=n.view;var r=e.split("."),i=0;while(t&&i<r.length)t=t[r[i++]]}else t=n.view[e];if(t!=null)break;n=n.parent}}this._cache[e]=t}typeof t=="function"&&(t=t.call(this.view));return t};v.prototype.clearCache=function(){this._cache={};this._partialCache={}};v.prototype.compile=function(t,n){var r=this._cache[t];if(!r){var i=e.parse(t,n);r=this._cache[t]=this.compileTokens(i,t)}return r};v.prototype.compilePartial=function(e,t,n){var r=this.compile(t,n);this._partialCache[e]=r;return r};v.prototype.getPartial=function(e){!(e in this._partialCache)&&this._loadPartial&&this.compilePartial(e,this._loadPartial(e));return this._partialCache[e]};v.prototype.compileTokens=function(e,t){var n=this;return function(r,i){if(i)if(typeof i=="function")n._loadPartial=i;else for(var s in i)n.compilePartial(s,i[s]);return m(e,n,d.make(r),t)}};v.prototype.render=function(e,t,n){return this.compile(e)(t,n)};e.parse=function(r,u){function E(){if(m&&!w)while(v.length)delete d[v.pop()];else v=[];m=!1;w=!1}r=r||"";u=u||e.tags;typeof u=="string"&&(u=u.split(n));if(u.length!==2)throw new Error("Invalid tags: "+u.join(", "));var f=b(u),c=new p(r),h=[],d=[],v=[],m=!1,w=!1,S,x,T,N,C;while(!c.eos()){S=c.pos;T=c.scanUntil(f[0]);if(T)for(var k=0,L=T.length;k<L;++k){N=T.charAt(k);a(N)?v.push(d.length):w=!0;d.push(["text",N,S,S+1]);S+=1;N=="\n"&&E()}if(!c.scan(f[0]))break;m=!0;x=c.scan(o)||"name";c.scan(t);if(x==="="){T=c.scanUntil(i);c.scan(i);c.scanUntil(f[1])}else if(x==="{"){T=c.scanUntil(new RegExp("\\s*"+l("}"+u[1])));c.scan(s);c.scanUntil(f[1]);x="&"}else T=c.scanUntil(f[1]);if(!c.scan(f[1]))throw new Error("Unclosed tag at "+c.pos);C=[x,T,S,c.pos];d.push(C);if(x==="#"||x==="^")h.push(C);else if(x==="/"){if(h.length===0)throw new Error('Unopened section "'+T+'" at '+S);var A=h.pop();if(A[1]!==T)throw new Error('Unclosed section "'+A[1]+'" at '+S)}else if(x==="name"||x==="{"||x==="&")w=!0;else if(x==="="){u=T.split(n);if(u.length!==2)throw new Error("Invalid tags at "+S+": "+u.join(", "));f=b(u)}}var A=h.pop();if(A)throw new Error('Unclosed section "'+A[1]+'" at '+c.pos);d=y(d);return g(d)};var w=new v;e.clearCache=function(){return w.clearCache()};e.compile=function(e,t){return w.compile(e,t)};e.compilePartial=function(e,t,n){return w.compilePartial(e,t,n)};e.compileTokens=function(e,t){return w.compileTokens(e,t)};e.render=function(e,t,n){return w.render(e,t,n)};e.to_html=function(t,n,r,i){var s=e.render(t,n,r);if(typeof i!="function")return s;i(s)};return e}());